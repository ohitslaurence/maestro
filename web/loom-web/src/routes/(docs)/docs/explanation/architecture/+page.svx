---
title: Architecture Overview
summary: Understand how Loom's components work together.
diataxis: explanation
order: 10
tags:
  - architecture
  - internals
---

<script>
	import { Callout } from '$lib/docs/components';
</script>

# Architecture Overview

Loom is designed as a distributed system with several key components working together.

## System Components

### Loom Server

The central hub that coordinates:

- **Thread Management**: Storing and syncing conversations
- **LLM Proxy**: Routing requests to AI providers
- **Authentication**: User identity and access control
- **Weaver Provisioning**: Managing remote execution environments

### Loom CLI

The command-line interface that users interact with directly. It:

- Maintains a local connection to the server
- Provides a REPL for conversations
- Executes tools on the local filesystem

### Weavers

Ephemeral execution environments for running agent tasks:

- Kubernetes pods with isolated filesystems
- Pre-configured with development tools
- Automatically cleaned up after use

## Data Flow

```
User → CLI → Server → LLM Provider
              ↓
         Weaver (optional)
```

1. User sends a message via CLI
2. CLI forwards to server via WebSocket
3. Server proxies to LLM provider
4. Response streams back through the same path
5. Tool calls may route to local CLI or remote Weaver

<Callout variant="info">
	The server acts as a "man in the middle" to enable features like session sharing, audit logging, and usage tracking.
</Callout>

## State Machine

The agent operates as a state machine:

| State | Description |
|-------|-------------|
| **Idle** | Waiting for user input |
| **Calling LLM** | Sending request to AI provider |
| **Processing Response** | Parsing LLM output |
| **Executing Tool** | Running a tool call |
| **Complete** | Task finished |

Transitions are triggered by events like user messages, LLM responses, and tool completions.

## Design Principles

1. **Server-side LLM**: The agent logic runs on the server, not in the CLI
2. **Streaming First**: All responses stream in real-time
3. **Tool Isolation**: Tools can run locally or remotely
4. **Audit Everything**: Complete history of all actions
